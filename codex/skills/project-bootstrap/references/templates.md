# 模板（最小可用）

> 说明：只提供最小骨架，避免把冗长模板灌入上下文；需要时再扩展。

## `Record/plan/draft-plan.md`（最小骨架）

```markdown
---
doc_type: plan
plan_version: ""
status: draft
created_at: ISO8601
project_root: "<确认的项目根目录>"
---

# 预定清单（草案）

## 详细需求描述

<!-- 完整记录需求，供 Claude 分析用 -->

## 待澄清问题

<!-- 需要进一步确认的点 -->
- 技术栈选择：...
- 部署方式：...
- 其他：...
```

## `Record/state.json`（最小骨架）

```json
{
  "active_plan_version": "",
  "agents_registry_path": "~/.codex/skills/agents-registry/references/registry.yaml",
  "environment_path": "~/environment.md",
  "proposals": {}
}
```

## `Record/record.md`（项目记录）

```markdown
# 项目记录

> 记录项目重大事件，便于回溯。git相关记录包含commit hash。

<!-- 由各阶段自动追加，勿手动编辑格式 -->
```

### 记录格式

```markdown
## YYYY-MM-DD HH:MM 事件类型
内容...
```

### 事件类型

| 类型 | 触发时机 | 记录内容 |
|------|---------|---------|
| 需求提出 | project-bootstrap | 需求摘要 |
| 方案确定 | plan-finalize | 方案版本、任务数 |
| 子代理完成 | 子代理提交后 | commit hash、提交信息 |
| 编译结果 | build-agent完成 | 成功/失败、产出/错误摘要 |
| 代码审核 | code-review完成 | 通过/问题数 |
| 提案修改 | Codex修改提案 | 修改原因、影响范围 |
| 归档完成 | project-complete步骤2 | commit hash、归档提案数 |
| 推送远程 | project-complete步骤4 | commit hash、远程分支 |
| 阻塞事件 | 环境/子代理缺失 | 阻塞原因、解决方式 |

## `Record/memory.md`（跨会话记忆）

```markdown
# 项目记忆

> 跨会话持久化的项目上下文，新会话开始时优先读取此文件。

## 基本信息

| 项目 | 内容 |
|-----|------|
| 项目名 | |
| 项目根目录 | |
| 技术栈 | |
| 创建时间 | |

## 关键决策

> 记录重要的技术/架构决策及其原因，避免后续会话重复讨论。

| 日期 | 决策 | 原因 |
|-----|------|------|
| | | |

## 核心文件索引

> 记录项目核心文件位置，加速新会话的代码定位。

| 文件/目录 | 用途 |
|----------|------|
| | |

## 已完成功能

> 已实现的主要功能清单。

- [ ]

## 待办/已知问题

> 尚未完成的功能或已知的技术债务。

- [ ]

## 会话摘要

> 每次会话结束时追加摘要，记录本次完成的工作和下次继续的方向。

### YYYY-MM-DD 会话标题
- **完成**：
- **遇到的问题**：
- **下次继续**：
```

### memory.md 使用规范

| 时机 | 操作 |
|-----|------|
| 新会话开始 | 读取 `Record/memory.md` 了解项目上下文 |
| 做出关键决策 | 更新"关键决策"章节 |
| 新增核心文件 | 更新"核心文件索引"章节 |
| 完成功能 | 更新"已完成功能"章节 |
| 会话结束 | 追加"会话摘要"章节 |

### 与 record.md 的区别

| 文件 | 用途 | 更新频率 |
|-----|------|---------|
| `record.md` | 事件日志（时间线） | 每个事件追加 |
| `memory.md` | 项目上下文（状态） | 按需更新 |
