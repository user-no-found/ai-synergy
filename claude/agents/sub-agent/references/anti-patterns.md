# 子代理反模式（Anti-Patterns）

创建子代理时应避免的常见错误及修复方法。

## 1. Quick Reference 变成文档堆砌

**症状**
- Quick Reference 包含大段文字、粘贴的文档或长篇摘录

**失败原因**
- 用户无法快速扫描和复用
- 模型将其视为"知识杂烩"而非可执行模式

**修复方法**
- 将长文本移至 `references/`（按主题拆分）
- Quick Reference 保持 <= 20 个可复制粘贴的模式
- 为非简单内容添加 Examples

## 2. 触发条件模糊（"帮助处理X"）

**症状**
- `description` 写成"帮助处理数据库"之类
- "When to Use" 是通用列表，无具体任务/输入/目标

**失败原因**
- 激活变得嘈杂且不可预测

**修复方法**
- 重写 `description` 为："做什么 + 何时触发"
- 在 "When to Use" 中列出可判定的任务：
  - "执行 Rust 项目的 cargo build --release"
  - "处理编译失败的错误追溯"
- 添加 "Not For / Boundaries" 防止误触发

## 3. 缺少边界定义

**症状**
- 子代理从不说明不做什么

**失败原因**
- 模型过度承诺并做出不安全假设
- 子代理在不相关场景被触发

**修复方法**
- 添加 `## Not For / Boundaries`：
  - 明确的超出范围项
  - 必需输入以及缺失时要问什么问题

## 4. 示例不可复现

**症状**
- 示例是伪代码、缺少输入或缺少预期输出

**失败原因**
- 用户无法信任或验证行为

**修复方法**
- 每个示例应包含：
  - 输入
  - 步骤
  - 预期输出/验收标准
- 优先使用最小可复现示例而非大型"展示"代码

## 5. 单文件综合症

**症状**
- 所有内容都在 `SKILL.md`（或一个巨大的参考文件）

**失败原因**
- 入口点变得难以扫描和维护

**修复方法**
- 保持 `SKILL.md` 以执行为中心（模式 + 示例 + 边界）
- 将长内容拆分到 `references/` 并添加 `references/index.md`

## 6. 编造事实和无法验证的声明

**症状**
- 子代理声称 API 字段/标志/命令但不引用来源

**失败原因**
- 错误的指导比缺失的指导更糟糕

**修复方法**
- 添加"验证路径"：在哪里/如何在官方文档或源代码中确认
- 优先使用有材料支持的陈述；明确标记假设

## 7. 不安全的默认操作

**症状**
- 子代理建议将破坏性命令作为默认路径

**失败原因**
- 用户复制粘贴后丢失数据

**修复方法**
- 将破坏性操作放在明确的警告和确认步骤之后
- 优先使用只读诊断

## 8. 术语不一致

**症状**
- 同一概念有多个名称；不同概念共用一个名称

**失败原因**
- 增加认知负担并产生不一致的输出

**修复方法**
- 添加简短的术语表（在 `references/` 或类似位置）
- 一个概念使用一个名称

## 9. 缺少完成流程

**症状**
- 子代理没有说明任务完成后要做什么

**失败原因**
- 输出不一致，可能遗漏必要步骤

**修复方法**
- 添加明确的完成流程：
  - 输出什么报告
  - 是否需要 git commit
  - 是否需要更新 record.md
  - 是否需要产出 impl.md

## 10. 硬性规则缺失

**症状**
- 子代理没有列出必须遵守的规则

**失败原因**
- 可能违反全局约定（如 AI 署名）

**修复方法**
- 添加 `### 硬性规则` 明确列出：
  - 禁止的操作
  - 必须遵守的格式
  - 报错语言要求
