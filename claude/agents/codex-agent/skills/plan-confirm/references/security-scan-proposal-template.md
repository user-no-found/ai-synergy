# 安全扫描提案模板

## 使用场景

用户在代码审核通过后，主动要求进行安全扫描时使用。

## Scope 文档模板

```yaml
---
proposal_id: security-scan-sec-agent
plan_version: {plan_version}
required_agent: sec-agent
doc_type: scope
created_at: {ISO8601}
---
```

```markdown
# Scope: security-scan-sec-agent

## 项目背景

### 项目名称
{项目名称}

### 项目目标
{项目目标}

### 当前阶段
代码审核已通过，进行安全扫描

## 本提案任务

### 任务目标
对项目进行安全扫描，识别潜在安全风险并输出报告

### 扫描范围
- 源代码目录：{源代码目录列表}
- 排除目录：{测试目录、第三方库等}

### 扫描类型
- [ ] 静态代码分析（必选）
- [ ] 依赖漏洞检查（必选）
- [ ] 动态扫描（可选，需HexStrike）

### HexStrike配置（如需动态扫描）

**是否使用HexStrike**: 是/否

如果使用：
- **目标地址**: {扫描目标IP/URL}
- **扫描类型**: 端口扫描 / Web漏洞扫描 / 综合扫描
- **扫描深度**: 快速 / 标准 / 深度

## 门禁配置

```json
{
  "allowed_paths": [
    "Record/security/"
  ],
  "forbidden_patterns": [
    "修改源代码",
    "删除文件"
  ],
  "output_only": true
}
```

## 技术要求

- 只读分析，不修改源代码
- 报告输出到 `Record/security/` 目录
- 报告使用中文

## 验收口径

- [ ] 完成静态代码安全分析
- [ ] 完成依赖漏洞检查
- [ ] 输出安全扫描报告
- [ ] 如有高危漏洞，提供修复建议
```

## Plan 文档模板

```yaml
---
proposal_id: security-scan-sec-agent
plan_version: {plan_version}
required_agent: sec-agent
doc_type: plan
created_at: {ISO8601}
---
```

```markdown
# Plan: security-scan-sec-agent

## 任务概述

### 背景
代码审核已通过，需要进行安全扫描以识别潜在安全风险

### 目标
完成安全扫描并输出报告

### 范围
- 包含：安全分析、漏洞检测、报告输出
- 不包含：代码修改、漏洞修复

## 任务清单

- [ ] 静态代码安全分析
- [ ] 依赖漏洞检查
- [ ] 动态扫描（如配置HexStrike）
- [ ] 生成安全报告

## 执行步骤

### 1. 静态代码安全分析

检查以下安全问题：
- SQL注入风险
- XSS风险
- 命令注入风险
- 路径遍历风险
- 硬编码敏感信息
- 不安全的加密实现
- 不安全的随机数生成

### 2. 依赖漏洞检查

- 检查项目依赖清单
- 对比已知漏洞数据库
- 标记有漏洞的依赖版本

### 3. 动态扫描（可选）

如果配置了HexStrike：

1. 检查HexStrike服务状态
   ```bash
   curl --noproxy '*' -s http://198.18.0.1:8888/health
   ```

2. 如服务不可用，通知用户启动WSL-Kali的HexStrike

3. 执行扫描（根据配置选择）：
   - 端口扫描：`nmap -sV -sC {target}`
   - Web扫描：`nikto -h {target}`
   - SQL注入：`sqlmap -u {url} --batch`

### 4. 生成安全报告

输出到 `Record/security/{plan_version}-security-report.md`

## 预期产出

| 文件路径 | 类型 | 说明 |
|---------|------|------|
| Record/security/{plan_version}-security-report.md | created | 安全扫描报告 |

## 注意事项

### 必须遵守
- 只读分析，不修改源代码
- 发现高危漏洞必须在报告中突出标记
- HexStrike扫描仅针对用户指定的授权目标

### 禁止事项
- 禁止修改任何源代码文件
- 禁止对未授权目标进行扫描
```

## 安全报告模板

```markdown
# 安全扫描报告

## 基本信息

- **项目名称**: {项目名称}
- **扫描时间**: {ISO8601}
- **扫描版本**: {plan_version}
- **扫描范围**: {扫描目录}

## 扫描摘要

| 风险等级 | 数量 |
|---------|------|
| 高危 | {N} |
| 中危 | {N} |
| 低危 | {N} |
| 信息 | {N} |

## 高危问题

### [HIGH-001] {问题标题}

- **文件**: {文件路径}
- **行号**: {行号}
- **类型**: {漏洞类型，如SQL注入}
- **描述**: {问题描述}
- **修复建议**: {修复建议}

## 中危问题

### [MED-001] {问题标题}
...

## 低危问题

### [LOW-001] {问题标题}
...

## 依赖漏洞

| 依赖名称 | 当前版本 | 漏洞ID | 严重程度 | 建议版本 |
|---------|---------|--------|---------|---------|
| {依赖} | {版本} | {CVE-ID} | {高/中/低} | {安全版本} |

## 动态扫描结果（如有）

### 端口扫描
{nmap结果摘要}

### Web漏洞扫描
{扫描结果摘要}

## 修复建议优先级

1. **立即修复**: {高危问题列表}
2. **尽快修复**: {中危问题列表}
3. **计划修复**: {低危问题列表}

## 结论

{总体安全评估}
```
